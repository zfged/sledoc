<?php require_once DIR_SYSTEM."lightning/config.php";$Wa=time()-$light_pagetime*60;$Wb=time()-$light_max_pagetime*60;if(!empty($_COOKIE['a']))return;$Wc=500*1024*1024;if(function_exists("apache_setenv"))apache_setenv("no-gzip","1");define('Wb',DIR_CACHE."lightning/".'c');define('Wbo',DIR_CACHE."lightning/cached_pages.log");$Wd=false;if(!empty($_SERVER["HTTPS"])&&(($_SERVER["HTTPS"]=="on")||($_SERVER["HTTPS"]=="1")))$Wd=true;elseif(!empty($_SERVER["SERVER_PORT"])&&$_SERVER["SERVER_PORT"]==443)$Wd=true;elseif(!empty($_SERVER["HTTP_X_FORWARDED_PROTO"])&&$_SERVER["HTTP_X_FORWARDED_PROTO"]=="https")$Wd=true;if($Wd){$_SERVER["HTTPS"]="1";$_SERVER["SERVER_PORT"]="443";}else{unset($_SERVER["HTTPS"]);$_SERVER["SERVER_PORT"]="80";}if(!empty($_GET["li_op"])){if(isset($_SERVER["HTTPS"])&&(($_SERVER["HTTPS"]=="on")||($_SERVER["HTTPS"]=="1"))&&substr(HTTP_SERVER,0,5)!="https"){$_SERVER["HTTPS"]=false;$_SERVER["SERVER_PORT"]=80;}}if(!file_exists(Wb)or filemtime(Wb)<time()-60*60*12){require_once"beta.php";Waz(true);if(!Wa()){if(!empty($_GET["li_op"])){$We["gen"]=false;$Wf=json_encode($We);echo($Wf);exit;}return;}}else Wa();if(!$light_cache_pages){if(!empty($_GET["li_op"])){if($_GET["li_op"]=="gen"and(!$light_cache_pages or!$light_pregenerate))exit;$We["gen"]=false;$Wf=json_encode($We);echo($Wf);exit;}return;}$Wg=false;if(!empty($_COOKIE["PHPSESSID"])){if(!session_id()){ini_set("session.use_only_cookies","On");ini_set("session.use_trans_sid","Off");ini_set("session.cookie_httponly","On");session_set_cookie_params(365*24*60*60,'/');session_start();}$Wh=session_id();$Wi=!empty($_SESSION["user_id"]);if(empty($_SESSION["customer_id"]))$Wj=0;else$Wj=$_SESSION["customer_id"];$Wk=$_SESSION;}else{$Wh=0;$Wi=0;$Wj=0;$Wk=array();}$Wl=!empty($_SERVER["HTTP_X_REQUESTED_WITH"]);$Wm=Wb();$Wn=Wc();$Wo=$Wm;if($Wp['b']and$Wj)$Wo.='CU';$Wq=false;if(!empty($_GET["li_op"])){$Wl=false;$Wq=$_GET["li_op"];if(isset($_GET["cd"])){$Wr=$_GET["cd"];if($Wr>10000000)$Wr=0;}if(isset($_GET["md"]))$Ws=$_GET["md"];}if(empty($light_ignore_url_params))$light_ignore_url_params="sdsdfsdfe";$light_ignore_url_params.=" li_sql";if(!empty($_GET["li_op"]))$light_ignore_url_params.=" li_op li_sql rd cd md";$_SERVER["REQUEST_URI"]=str_replace('?','&',$_SERVER["REQUEST_URI"]);foreach(explode(' ',$light_ignore_url_params)as$Wt)if(isset($_GET[$Wt])){$_SERVER["REQUEST_URI"]=str_replace('&'.$Wt.'='.$_GET[$Wt],'',$_SERVER["REQUEST_URI"]);unset($_GET[$Wt]);}if(substr($_SERVER["REQUEST_URI"],-1)=="&")$_SERVER["REQUEST_URI"]=substr($_SERVER["REQUEST_URI"],0,-1);if($Wu=strpos($_SERVER["REQUEST_URI"],'&'))$_SERVER["REQUEST_URI"]=substr($_SERVER["REQUEST_URI"],0,$Wu).'?'.substr($_SERVER["REQUEST_URI"],$Wu+1);if($Wl or!$light_convert_currencies){$Wv=$Wo;$Wo.=$Wn;}if(session_id()and((VERSION<"2.0"&&ini_get("register_globals"))or$Wq))session_write_close();$_SERVER["REQUEST_URI"]=Wd($_SERVER["REQUEST_URI"]);$Ww="http".(($_SERVER["SERVER_PORT"]==443)?"s://":"://").$_SERVER["HTTP_HOST"].Wcw($_SERVER["REQUEST_URI"]);$Wx=$Wo.$Ww;if($Wp['d']and!$Wi)$Wx=$Wo.'e';if($Wq=="gen"){ignore_user_abort(true);$Wy=time();require_once"beta.php";We();return;}if($Wl and!$light_cache_ajax)return;if($Wz)return;if($_SERVER["REQUEST_METHOD"]==="POST"){if($Wl){if(!empty($_POST))$Wx.=serialize($_POST);}else{$Wx=false;return;}}if($Wl)$W_=DIR_CACHE."lightning/tetha";else$W_=DIR_CACHE."lightning/alpha";$Wf=false;$Waa=md5($Wx);$Wab="/".substr($Waa,0,2)."/c".substr($Waa,2);if($Wq=="gens"){if($Wp['d']and!$Wi)exit;ignore_user_abort(true);$Wy=time();require_once"beta.php";Wf();$We["gen"]=Wg();$We["md"]=array();if(empty($Ws)){if($We["gen"]){We();return;}Wh();}unset($Wac);unset($_GET["rd"]);return;}if(!empty($_SESSION["customer_id"])){if(!Wa($Wm))return;if(!$Wg['p'])return;}if(!file_exists($W_.$Wab)){Wi();return;}$Wad=0;$Wae=0;$Wad=filemtime($W_.$Wab);if($Wad<$Wb){Wi();return;}$Waf=$Wj||!empty($_SESSION["cart"])||!empty($_SESSION["wishlist"])||!empty($_SESSION["compare"])||($Wn!=$Wp['f']&&$light_convert_currencies);if($Waf){if($Wj&&!$light_modify_login)return;if(!empty($_SESSION["cart"])&&!$light_modify_cart)return;if(!empty($_SESSION["wishlist"])&&!$light_modify_wishlist)return;if(!empty($_SESSION["compare"])&&!$light_modify_compare)return;}if(!empty($light_track_last_modified)and($Wm==$Wp['ae'])and($Wag or(!$Waf&&$Wn==$Wp['f']))){header("Cache-Control: must-revalidate");$Wah=DIR_CACHE."lightning/delta".$Wab;if(file_exists($Wah)){$Wah=unserialize(file_get_contents($Wah));if($Wag)$Wai=$Wah["smd"];else$Wai=$Wah["md"];if(!empty($_SERVER["HTTP_IF_MODIFIED_SINCE"])){$Waj=@strtotime(substr($_SERVER["HTTP_IF_MODIFIED_SINCE"],5));if($Waj&&$Waj>=$Wai){header($_SERVER["SERVER_PROTOCOL"]." 304 Not Modified");Wap();exit;}}header("Last-Modified: ".gmdate("D, d M Y H:i:s \G\M\T",$Wai));}}if($Wi){$Wak=DIR_CACHE."lightning/gamma".$Wab;if(file_exists($Wak))unlink($Wak);}$Wf=file_get_contents($W_.$Wab);if(!$Wl)if($Waf){if(!Wa($Wm))return;if(!empty($_SESSION["customer_id"])and!$Wg['p'])return;Wk($Wf);if($Wn!=$Wp['f']&&$light_convert_currencies){if(!$Wg['h'])return;$Wal=$Wg['g'][$Wn];Wl('',"//$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]",'name="redirect" value="','"',$Wal);Wm($Wg['h'],$Wal,$Wf);Wn($Wp['f'],$Wn,$Wf);}if(!empty($_SESSION['i'])){if(!$Wg['j'])return;Wm($Wg['j'],$_SESSION['i'],$Wf);}if(!empty($_SESSION["wishlist"]))Wm($Wg['k'],count($_SESSION["wishlist"]),$Wf);if(!empty($_SESSION["compare"]))Wm($Wg['l'],count($_SESSION["compare"]),$Wf);if(!empty($_SESSION["customer_id"])){if(!$Wg['p'])return;if(empty($_SESSION['m']))$Wam="Customer";else$Wam=$_SESSION['m'];$Wan=str_replace('<Wn>',$Wam,$Wg['o']);Wm($Wg['p'],$Wan,$Wf);}}if(strpos($Wx,"journal2/assets/css")){header("Content-Type: text/css");}elseif(strpos($Wx,"journal2/assets/js")){header("Content-Type: application/javascript");}else header("Content-Type: text/html; charset=utf-8");if($Wl&&((($Wad-Wj($Wx))<$Wa)or$Wi)){Wo($Wf,true);require_once"beta.php";$Wao=2;ini_set("display_errors","Off");ini_set("log_errors","Off");Wi();return;}Wo($Wf);exit;function Wf(){global$db,$Wp,$Ww,$Wj;if(!$Wp['q'])return;$Wap=false;if(!$db){$db=Wcs();$Wap=true;}if(isset($_SERVER["REMOTE_ADDR"])){$Waq=$_SERVER["REMOTE_ADDR"];}else{$Waq='';}$War=$Ww;$Was='';$db->query("DELETE FROM `".DB_PREFIX."customer_online` WHERE (UNIX_TIMESTAMP(`date_added`) + 3600) < UNIX_TIMESTAMP(NOW())");$db->query("REPLACE INTO `".DB_PREFIX."customer_online` SET `ip` = '".$db->escape($Waq)."', `customer_id` = '".(int)$Wj."', `url` = '".$db->escape($War)."', `referer` = '".$db->escape($Was)."', `date_added` = NOW()");if($Wap)$db=false;}function Wp(){global$Wq,$Wk,$Wao;if($Wao==2){$Wao=false;Wbs();}if($Wq!="gen"&&$Wq!="gens"&&!$Wao)return array();if(session_id())session_write_close();return$Wk;}function Wq($Wat){$Wau=0;while($Wat>=1024){$Wat/=1024;$Wau++;}if($Wat<10)$Wat=round($Wat,2);else$Wat=round($Wat);$Wav=array("bytes","Kb","Mb","Gb","Tb");$Waw=$Wat." ".$Wav[$Wau];return$Waw;}function Wd($War){if(substr($War,-27)=="index.php?route=common/home")$War=substr($War,0,-27);elseif(substr($War,-9)=="index.php")$War=substr($War,0,-9);$War=urldecode($War);$War=str_replace("&amp;","&",$War);$Wax=substr($War,-1);if($Wax=="?"||$Wax=="&")$War=substr($War,0,-1);return$War;}function Wcw($War){global$light_ignore_url_params;if(!$light_ignore_url_params)return$War;$War=str_replace('?','&',$War);foreach(explode(' ',$light_ignore_url_params)as$Wt)if(isset($_GET[$Wt])){$War=str_replace('&'.$Wt.'='.$_GET[$Wt],'',$War);}$Wax=substr($War,-1);if($Wax=="&")$War=substr($War,0,-1);$Wu=strpos($War,'&');if($Wu)$War=substr($War,0,$Wu).'?'.substr($War,$Wu+1);if(substr($War,-27)=="index.php?route=common/home")$War=substr($War,0,-27);elseif(substr($War,-9)=="index.php")$War=substr($War,0,-9);return$War;}function Wh($Way=false){global$We,$Wq,$Wac,$W_;header("HTTP/1.1 200 OK");;if(!$We){if($Way){if($Wq=="gen"&&!$Wac['id']){$W_=DIR_CACHE."lightning/alpha";$Waz=Wr();$Wa_["pages"]=$Waz[0];$Wa_["psize"]=Wq($Waz[1]);$Wa_["width"]=round(($Wac['r']-count($Wac['s']))/$Wac['r']*200);$Wa_["percent"]=round(($Wac['r']-count($Wac['s']))/$Wac['r']*100);$Wa_["width"].="px";$Wf=json_encode($Wa_);echo$Wf;}else echo"OK";}exit;}if($Way and!$Wac['id']and!file_exists(Wb.'t'))file_put_contents(Wb.'t','1');if(!$Way and!$Wac['id']and file_exists(Wb.'t'))unlink(Wb.'t');$We["gen"]=$Way;$Wf=json_encode($We);echo($Wf);exit;}function We(){if(!file_exists(Wb.'u'))Wh();global$Wac,$Wr,$W_,$Ww,$Wo,$Wa,$Wba;$Wac=unserialize(file_get_contents(Wb.'u'));if($Wac['id']!=$Wr)Wh();$W_=DIR_CACHE."lightning/alpha";$Wba=$Ww;$Ww=false;foreach($Wac['s']as$Wbb=>$War){unset($Wac['s'][$Wbb]);$Wbc=Ws($Wo.$War)-Wj($Wo.$War);$Ww=$War;if($Wbc<=$Wa)break;$Ww=false;if($Wac['v']>$Wbc)$Wac['v']=$Wbc;}$Wbd=time()-Wj($Wo.$Ww);if($Wac['v']>$Wbd)$Wac['v']=$Wbd;if(!$Ww){unlink(Wb.'u');if(Wg($Wba)){We();return;}Wh();}if(!$Wac['s']){unlink(Wb.'u');if(!$Wac['id']and file_exists(Wb.'t'))unlink(Wb.'t');if($Wac['w'])touch($Wac['w'],$Wac['v']);}else{file_put_contents(Wb.'u',serialize($Wac));if(!$Wac['id']){$Wbe=round(($Wac['r']-count($Wac['s']))/$Wac['r']*100);file_put_contents(Wb.'t',round(($Wac['r']-count($Wac['s']))/$Wac['r']*100));}}global$Wx,$Wbf;header("X-OpenCart-Lightning-Gen: $Ww");$Wx=$Wo.$Ww;$Wbg=str_replace("//",'',$Ww);$Wu=strpos($Wbg,'/');$_SERVER["REQUEST_URI"]=substr($Wbg,$Wu);$War=str_replace('?','&',str_replace($Wbf,"",$Ww));$Wbh=explode('&',$War);$_GET=array();if(!$Wbh)$Wbh[0]='';if($Wbh[0]=="index.php")$Wbh[0]='';if($Wbh[0])$_GET["_route_"]=$Wbh[0];unset($Wbh[0]);foreach($Wbh as$Wbi){if(!$Wbi)continue;$Wbi=explode('=',$Wbi);$_GET[$Wbi[0]]=$Wbi[1];}Wi();}function Wt($Wab){global$W_,$Wac,$Wr,$Wo,$Wa,$Wb;$W_=DIR_CACHE."lightning/alpha";$Wac['w']=$Wab;$Wac['id']=$Wr;$Wac['v']=time();if(strpos($Wab,"//")!==false){$Wac['w']=false;$Wbj=array($Wab);}else$Wbj=unserialize(file_get_contents($Wab));if(!$Wbj)$Wbj=array();$Wbk=array();$Wbl=time();foreach($Wbj as$Wbm=>$War){$Wbc=Ws($Wo.$War);if($Wbc<$Wb){$Wbk[]=$War;unset($Wbj[$Wbm]);continue;}if($War==$Wab){Wu($Wo.$War);continue;}$Wbc=$Wbc-Wj($Wo.$War);if($Wbc>$Wa)unset($Wbj[$Wbm]);if($Wbc<$Wbl)$Wbl=$Wbc;}$Wbj=array_merge($Wbk,$Wbj);if(!$Wbj){if(file_exists(Wb.'u'))unlink(Wb.'u');if($Wac['w'])touch($Wab,$Wbl);return false;}$Wac['s']=$Wbj;$Wac['r']=count($Wbj);file_put_contents(Wb.'u',serialize($Wac));return true;}function Wg($Wba=false){global$Wo,$Wbf,$Ww,$Wa,$Wb;if(!$Wba)$Wba=$Ww;if(!$Wba)$Wba=$Wbf;if(file_exists(Wb.'u')&&filemtime(Wb.'u')>(time()-180)){$Wac=unserialize(file_get_contents(Wb.'u'));if(!$Wac['id']and$Wac['s'])return false;}$Waa=md5($Wo.$Wbf);$Wbn=DIR_CACHE."lightning/gamma"."/".substr($Waa,0,2)."/c".substr($Waa,2);if(!file_exists($Wbn)and Wt($Wbf))return true;$Waa=md5($Wo.$Wba);$Wbo=DIR_CACHE."lightning/gamma"."/".substr($Waa,0,2)."/c".substr($Waa,2);if(!file_exists($Wbo)and Wt($Wba))return true;if(file_exists($Wbn)&&filemtime($Wbn)<=$Wb&&Wt($Wbn))return true;if(file_exists($Wbo)&&filemtime($Wbo)<=$Wb&&Wt($Wbo))return true;if(file_exists($Wbn)&&filemtime($Wbn)<=$Wa&&Wt($Wbn))return true;if(file_exists($Wbo)&&filemtime($Wbo)<=$Wa&&Wt($Wbo))return true;return false;}function Wv($Wbp,$War){static$Wbq;if(!$Wbq){if(Ww())$Wbq=1;else$Wbq=-1;}if($Wbq>0)return;if(Ww($Wbp))return;global$Wbr;$War=str_replace("page={page}","",$War);$War=preg_replace("/page=[0-9]+/","",$War);$War=preg_replace("/page-[0-9]+/","",$War);$Wbr[]=$War;}function Wi(){global$light_ob;register_shutdown_function('Wac');ob_start();$light_ob=true;}function Wx($Wbp){$Wbs=Wy("","/",$Wbp);if($Wbs!=="module")return array();$Wam=Wy("/","",$Wbp);global$request,$config;if(isset($request->get['route'])){$Wbp=(string)$request->get['route'];}else{$Wbp='common/home';}$Wbt=0;Wz('load')->model('design/layout');if($Wbp=='product/category'&&isset($request->get['path'])){$Wbu=explode('_',(string)$request->get['path']);Wz('load')->model('catalog/category');$Wbt=Wz('model_catalog_category')->getCategoryLayoutId(end($Wbu));}if($Wbp=='product/product'&&isset($request->get['product_id'])){Wz('load')->model('catalog/product');$Wbt=Wz('model_catalog_product')->getProductLayoutId($request->get['product_id']);}if($Wbp=='information/information'&&isset($request->get['information_id'])){Wz('load')->model('catalog/information');$Wbt=Wz('model_catalog_information')->getInformationLayoutId($request->get['information_id']);}if(!$Wbt){$Wbt=Wz('model_design_layout')->getLayout($Wbp);}if(!$Wbt){$Wbt=$config->get('config_layout_id');}if(VERSION>="2.0"){global$db;$Wbv=$db->query("SELECT * FROM ".DB_PREFIX."layout_module WHERE layout_id = '".(int)$Wbt."'")->rows;Wz('load')->model('extension/module');foreach($Wbv as$Wbw){$Wbx=explode('.',$Wbw['code']);if($Wbx[0]!=$Wam)continue;if(isset($Wbx[0])&&$config->get($Wbx[0].'_status')){return array();}if(isset($Wbx[1])){$Wby=Wz('model_extension_module')->getModule($Wbx[1]);if($Wby&&$Wby['status']){return$Wby;}}}return array();}$Wbv=$config->get($Wam.'_module');if(!$Wbv)return array();foreach($Wbv as$Wbw)if($Wbw['layout_id']==$Wbt&&$Wbw['status'])return$Wbw;return array();}function W_(){global$Wq,$light_ob,$Ws,$config;if($light_ob)$config->set('bn',0);if($Wq=="gens"&&$Ws){global$We,$registry,$Ws;$Wbz=explode("~",$Ws);foreach($Wbz as$Wbm=>$Wb_){$Wu=strpos($Wb_,'_');$Wbz[$Wbm]=substr($Wb_,0,$Wu)."/".substr($Wb_,$Wu+1);}global$request;if(!empty($request->get["route"]))$Wbp=$request->get["route"];else$Wbp="common/home";if(VERSION>"2.0"){foreach($Wbz as$Wb_)$We["md"]["#".str_replace("/","_",$Wb_)]=Wz("load")->controller($Wb_,Wx($Wb_));}else{Wz("load")->model("setting/extension");class ControllerFake extends Controller{}$Wca=new ControllerFake($registry);foreach($Wbz as$Wb_){$We["md"]["#".str_replace("/","_",$Wb_)]=$Wca->getChildHtml($Wb_,Wx($Wb_));}}$Wf=json_encode($We);Wab($Wf);echo($Wf);exit;}}function Wk(&$Wf){if(!$Wf||(ord($Wf[0])!=31))return;if(function_exists("gzdecode"))$Wf=gzdecode($Wf);else$Wf=gzinflate(substr($Wf,10,-8));}function Wac(){global$light_ob,$Ww,$Wcb,$Wcc,$Wz;if(!$light_ob)return;$Wcd='';Wbs();while($Wu=ob_get_level()){$Wcd=ob_get_contents().$Wcd;ob_end_clean();if(ob_get_level()==$Wu)break;}if(!trim($Wcd))exit;global$light_modify_cart,$light_modify_login,$light_modify_wishlist,$Wm,$Wg;$Wce=false;if(!empty($_SESSION["cart"])&&!$light_modify_cart)$Wce=true;elseif(!empty($_SESSION["customer_id"])&&!$light_modify_login)$Wce=true;elseif(!empty($_SESSION["wishlist"])&&!$light_modify_wishlist)$Wce=true;elseif(!empty($_SESSION["cart"])||!empty($_SESSION["customer_id"])||!empty($_SESSION["wishlist"])){Wa($Wm);if(!empty($_SESSION["cart"])&&!$Wg['j'])$Wce=true;elseif(!empty($_SESSION["customer_id"])&&!$Wg['p'])$Wce=true;elseif(!empty($_SESSION["wishlist"])&&!$Wg['k'])$Wce=true;}if($Wce||Ww()||$Wz){global$Wac;if($Wac)Wh(!empty($Wac['s']));global$light_track_last_modified,$Wn,$Wp;if($light_track_last_modified)if(empty($_SESSION["cart"])&&empty($_SESSION["customer_id"])&&empty($_SESSION["wishlist"])&&empty($_SESSION["cart"])&&$Wn==$Wp['f'])Wdh($Wcd);Wao();if(headers_sent())Wk($Wcd);Wo($Wcd);exit;}Wk($Wcd);$War=$Ww;if(strpos($War,'?')or strpos($War,'&'))$War.='&';else$War.='?';$War.="li_op=gen";global$Wcf,$light_pregenerate;if($Wcf){$Wcf=str_replace("/","_",implode("~",$Wcf));}$Wcg="<script type='text/javascript'>var li_cd=Math.floor(Math.random()*1000000);$(document).ready(function(){ $.get('".$War."s&md=".$Wcf."&cd='+li_cd,false,function(data){ $.each(data['md'],function(m,html){ $(m).replaceWith(html);});if(data['gen'])li_gen();},'json');});";$Wcg.="function li_gen(){ $.get('".$War."&cd='+li_cd+'&rd='+Date.now(),false,function(data){if(data.trim()=='OK')li_gen();});}";$Wcg.="</script>";$Wu=strpos($Wcd,"</body>");if($Wu){if(strpos($Wcd,"jquery",$Wu))$Wu=strpos($Wcd,"</html>");if($Wu)$Wcd=substr($Wcd,0,$Wu).$Wcg.substr($Wcd,$Wu);}$Wch=Wad($Wcd);global$Wac;if($Wac){Wao();Wh(!empty($Wac['s']));}if(!$Wch){Wab($Wcd,2);Wo($Wcd);}else Wo($Wch);exit;}function Ww($Wbp=false){if(!$Wbp){global$request;if(!empty($request->get["route"]))$Wbp=$request->get["route"];else$Wbp="common/home";}global$light_cache_critical_only,$Wl;if($light_cache_critical_only and!$Wl){return!Wae("critical",$Wbp);}$Wci=Wae("ignore",$Wbp);if($Wci and Wae("not_ignore",$Wbp))$Wci=false;if($Wci)return true;if($Wl){global$Wv,$W_;$Wcj=$W_;$W_=DIR_CACHE."lightning/alpha";if(empty($_SERVER["HTTP_REFERER"]))return true;$War=Wd($_SERVER["HTTP_REFERER"]);$Wbc=Ws($Wv.$War);$W_=$Wcj;if(!$Wbc)return true;}return false;}function Wae($Wck,$War){$Wcl=$GLOBALS["light_".$Wck."_list"];if(!$Wcl)return false;$Wcl=explode(" ",$Wcl);$Wcm=false;foreach($Wcl as$Wbp)if(strpos($War,$Wbp)!==false){$Wcm=true;break;}return$Wcm;}function Wm($Wcn,$Wco,&$Wcp){if(!$Wcn)return;$Wcq=explode("%*%",$Wcn['y']);$Wcr=0;foreach($Wcq as$Wcs){$Wcr=strpos($Wcp,$Wcs,$Wcr);if($Wcr===false)return;$Wcr+=strlen($Wcs);}$Wu=$Wcr;$Wct=explode("%*%",$Wcn['z']);foreach($Wct as$Wcs){$Wcu=strpos($Wcp,$Wcs,$Wu);if($Wcu===false)return;$Wu=$Wcu+strlen($Wcs);}$Wcp=substr($Wcp,0,$Wcr).$Wco.substr($Wcp,$Wcu);}function Wl($Wcv,$Wco,$Wcw,$Wax,&$Wcp){$Wcr=0;while(($Wcr=stripos($Wcp,$Wcw,$Wcr))!==false){$Wcr+=strlen($Wcw);if($Wax)$Wcu=stripos($Wcp,$Wax,$Wcr);else$Wcu=strlen($Wcp);if($Wcu){$Wcx=substr($Wcp,0,$Wcr);$Wcy=substr($Wcp,$Wcu);$Wcz=substr($Wcp,$Wcr,$Wcu-$Wcr);$Wc_=strlen($Wcz);if($Wcv!=='')$Wcz=str_ireplace($Wcv,$Wco,$Wcz);else$Wcz=$Wco;$Wcp=$Wcx.$Wcz.$Wcy;$Wcu=$Wcu+strlen($Wcz)-$Wc_;$Wcr=$Wcu+strlen($Wax);if($Wcr>strlen($Wcp))break;}}}function Wad($Wda){global$Wx,$Wm,$Wg,$Wp,$Wl,$light_convert_currencies;if(!$Wx)return false;if(strpos($Wda,"<b>Fatal error<"))return false;if(!$Wl){if(!empty($_SESSION["cart"])){Wa($Wm);Wm($Wg['j'],$Wg['_'],$Wda);}if(!empty($_SESSION["wishlist"])and$Wg['k']){Wa($Wm);Wm($Wg['k'],"0",$Wda);}if(!empty($_SESSION["compare"])and$Wg['l']){Wa($Wm);Wm($Wg['l'],"0",$Wda);}if(!empty($_SESSION["customer_id"])){Wa($Wm);if(!$Wg['p'])return false;Wm($Wg['p'],$Wg['aa'],$Wda);}$Wdb=Wz("currency")->getCode();if($Wdb!=$Wp['f']&&$light_convert_currencies){Wa($Wm);$Wal=$Wg['g'][$Wp['f']];Wl('',"//$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]",'name="redirect" value="','"',$Wal);Wm($Wg['h'],$Wal,$Wda);Wn($Wdb,$Wp['f'],$Wda);}}$Wdc=gzencode($Wda,9);global$W_,$Wdd,$light_max_pagetime;$Wdd=$light_max_pagetime*60;if($Wl)$W_=DIR_CACHE."lightning/tetha";else$W_=DIR_CACHE."lightning/alpha";Waf($Wx,$Wdc,true);global$light_track_last_modified;if($light_track_last_modified)Wdh($Wda);$Wdd=$light_max_pagetime*60;global$light_pregenerate,$Wbr,$Ww,$Wbf;if($light_pregenerate and!$Wl and$Wbr){global$Wo,$request;$Wbj=Wag("href='","'",str_replace('"',"'",$Wda));$Wbj=array_unique($Wbj);foreach($Wbj as$Wbm=>$War){$War=preg_replace("/page=[0-9]+/","",$War);$War=preg_replace("/page-[0-9]+/","",$War);if(!strpos($War,"://")){$Wu=array_search($War,$Wbr);if(substr($War,0,1)=="/")$War=substr($War,1);$War=$Wbf.$War;$Wbj[$Wbm]=$War;if($Wu)$Wbr[$Wu]=$War;}if(!in_array($War,$Wbr))unset($Wbj[$Wbm]);else$Wbj[$Wbm]=Wd($Wbj[$Wbm]);}$W_=DIR_CACHE."lightning/gamma";if(!empty($request->get["route"]))$Wbp=$request->get["route"];else$Wbp="common/home";if($Wbp!="common/home"){$Wde=Wah($Wo.$Wbf);if($Wde)$Wbj=array_diff($Wbj,unserialize($Wde));}global$Wb;if(!in_array($Ww,$Wbj))$Wbj=array_merge(array($Ww),$Wbj);Waf($Wx,serialize(array_values($Wbj)),true);Wai($Wx,$Wb);global$Wac,$Wba;if($Wac and!$Wac['s']){Wg($Wba);}}if($Wg)return false;else return$Wdc;}function Wdh($Wda){global$W_,$Wdd,$light_max_pagetime,$Wx,$Wag,$Wac,$Wq;$W_=DIR_CACHE."lightning/delta";$Wdd=$light_max_pagetime*60*7;$Wdf=crc32($Wda);$Wah=Wah($Wx);if($Wah)$Wah=unserialize($Wah);if(empty($Wah["cs"])||$Wah["cs"]!=$Wdf){$Wah["key"]=$Wx;$Wah["cs"]=$Wdf;$Wah["md"]=time();$Wdg=preg_replace(array("/<script\\b[^>]*>(.*?)<\\/script>/is","/\\d\\w*/","/\\s+/s"),array("",""," "),$Wda);$Wdh=crc32($Wdg);if(empty($Wah["scs"])||$Wah["scs"]!=$Wdh){$Wah["scs"]=$Wdh;$Wah["smd"]=time();}Waf($Wx,serialize($Wah));}if($Wac or$Wq)return;if($Wag)$Wai=$Wah["smd"];else$Wai=$Wah["md"];header("Cache-Control: must-revalidate");header("Last-Modified: ".gmdate("D, d M Y H:i:s \G\M\T",$Wai));if(!empty($_SERVER["HTTP_IF_MODIFIED_SINCE"])){Wbs();$Waj=strtotime(substr($_SERVER["HTTP_IF_MODIFIED_SINCE"],5));Wbt();if($Waj&&$Waj>=$Wai){header($_SERVER["SERVER_PROTOCOL"]." 304 Not Modified");Wao();Wap();exit;}}}function Waj(){global$Wp,$Wbf;if(!file_exists(Wb)){echo"{\"gen\":false,\"md\":[]}";exit;}$Wp=unserialize(file_get_contents(Wb));$Wp['af']=0;if($Wp['ab']){if(isset($_SERVER["HTTPS"])&&(($_SERVER["HTTPS"]=="on")||($_SERVER["HTTPS"]=="1")))$War="https://";else$War="http://";$War.=str_replace('www.','',$_SERVER['HTTP_HOST']).rtrim(dirname($_SERVER['PHP_SELF']),'/.\\').'/';foreach($Wp['ab']as$Wdi=>$Wdj)if(str_replace("/www.","/",$Wdj['ac'])==$War ||str_replace("/www.","/",$Wdj['ad'])==$War){if(str_replace("/www.","/",$Wdj['ad'])==$War)$Wbf=$Wdj['ad'];else$Wbf=$Wdj['ac'];$Wp['ae']=$Wdj['ae'];$Wp['f']=$Wdj['f'];$Wp['b']=$Wdj['b'];$Wp['af']=$Wdi;break;}}}function Wa($Wdk=''){global$Wp,$Wg,$Wbf;if($Wdk and$Wg)return true;global$Wc;$Wdl=@disk_free_space(DIR_CACHE);if($Wdl&&$Wdl<$Wc){Wak("Not enough free disk space");return false;}if(!$Wbf)if(isset($_SERVER["HTTPS"])&&(($_SERVER["HTTPS"]=="on")||($_SERVER["HTTPS"]=="1")))$Wbf=HTTPS_SERVER;else$Wbf=HTTP_SERVER;if($Wdk and$Wp['af'])$Wdk.=$Wp['af'];if(file_exists(Wb.$Wdk)){if($Wdk){$Wg=unserialize(file_get_contents(Wb.$Wdk));return true;}else{Waj();if(!$Wp['af']&&filemtime(Wb)<time()-60*60*12){unlink(Wb);}else return true;}}if(file_exists(Wb.$Wdk))unlink(Wb.$Wdk);if(strpos(HTTP_SERVER,"/localhost/"))$Wdm="http://localhost/high2/service/";else$Wdm="http://lightning.devs.mx/service/";global$Wbf;$Wdn=$Wdm."saas.php?".'ag'."=".str_replace("://","x!x",$Wbf)."&".'ah'."=".$Wdk;$Wa_=false;if(!$Wdk){global$light_hard_optimization,$db;$Wap=false;if(!$db){$db=Wcs();$Wap=true;}$Wdo=$db->query("SELECT * FROM ".DB_PREFIX."setting LIMIT 1")->row;$Wdp=false;if(isset($Wdo['bb']))$Wdp='bb';elseif(isset($Wdo['bm']))$Wdp='bm';$Wdq="SELECT * FROM ".DB_PREFIX."setting";if($Wdp)$Wdq.=" WHERE `$Wdp`='config'";$Wa_['ai']=serialize($db->query($Wdq)->rows);$Wa_['aj']=serialize($db->query("SELECT * FROM `".DB_PREFIX."language`")->rows);$Wa_['ak']=serialize($db->query("SELECT * FROM ".DB_PREFIX."currency")->rows);$Wa_['al']=DB_PREFIX;$Wa_['x']=$light_hard_optimization;$Wa_['ao']=3;if($Wap)$db=false;}$Wdr=Wal($Wdn,$Wa_);if(substr($Wdr,0,1)=="!"){Wak(substr($Wdr,2));return false;}if(!$Wdk&&$Wdr!=='OK'){if(substr($Wdr,0,2)=="a:"){if(!file_exists(DIR_CACHE."lightning")){@mkdir(DIR_CACHE."lightning",0777,true);@chmod(DIR_CACHE."lightning",0777);}$Wds=unserialize($Wdr);@file_put_contents(Wb,stripslashes($Wds['lc']));$Wdt=unserialize(stripslashes($Wds['bd']));foreach($Wdt as&$Wdu)$Wdu=str_replace("xy".'aq'."xy","SELECT",$Wdu);@file_put_contents(Wb.'bd',serialize($Wdt));}else{Wak("Lightning server communication error");return false;}}global$Wdv;if(file_exists($Wdv)){unlink($Wdv);}if(!$Wdk){Waj();return true;}$Wg=unserialize($Wdr);file_put_contents(Wb.$Wdk,$Wdr);return true;}function Wb(){global$Wp,$Wh;if(!$Wp){if($Wh and isset($_SESSION['language'])and is_string($_SESSION['language']))return$_SESSION['language'];if(isset($_COOKIE['language']))return$_COOKIE['language'];return"en";}$languages=$Wp['am'];$Wdw='';if(isset($_SERVER['HTTP_ACCEPT_LANGUAGE'])&&$_SERVER['HTTP_ACCEPT_LANGUAGE']){$Wdx=explode(',',$_SERVER['HTTP_ACCEPT_LANGUAGE']);foreach($Wdx as$Wdy){foreach($languages as$Wdz=>$Wd_){if($Wd_['status']){$Wea=explode(',',$Wd_['locale']);if(in_array($Wdy,$Wea)){$Wdw=$Wdz;}}}}}if($Wh and isset($_SESSION['language'])and!is_string($_SESSION['language']))unset($_SESSION['language']);if($Wh&&isset($_SESSION['language'])&&array_key_exists($_SESSION['language'],$languages)&&$languages[$_SESSION['language']]['status']){$Web=$_SESSION['language'];}elseif(isset($_COOKIE['language'])&&array_key_exists($_COOKIE['language'],$languages)&&$languages[$_COOKIE['language']]['status']){$Web=$_COOKIE['language'];}elseif($Wdw){$Web=$Wdw;}else{$Web=$Wp['ae'];}if(!isset($_SESSION['language'])||$_SESSION['language']!=$Web){$_SESSION['language']=$Web;}if(!isset($_COOKIE['language'])||$_COOKIE['language']!=$Web){setcookie('language',$Web,time()+60*60*24*30,'/',$_SERVER['HTTP_HOST']);$_COOKIE['language']=$Web;}return Wam($Web);}function Wan(){if(!isset($_SERVER['HTTP_USER_AGENT']))return false;$Wec=$_SERVER['HTTP_USER_AGENT'];$Wed="desktop";if((preg_match('/GoogleTV|SmartTV|Internet.TV|NetCast|NETTV|AppleTV|boxee|Kylo|Roku|DLNADOC|CE\-HTML/i',$Wec))){$Wed="tv";}elseif((preg_match('/Xbox|PLAYSTATION.3|Wii/i',$Wec))){$Wed="tv";}elseif((preg_match('/iP(a|ro)d/i',$Wec))||(preg_match('/tablet/i',$Wec))&&(!preg_match('/RX-34/i',$Wec))||(preg_match('/FOLIO/i',$Wec))){$Wed="tablet";}elseif((preg_match('/Linux/i',$Wec))&&(preg_match('/Android/i',$Wec))&&(!preg_match('/Fennec|mobi|HTC.Magic|HTCX06HT|Nexus.One|SC-02B|fone.945/i',$Wec))){$Wed="tablet";}elseif((preg_match('/Kindle/i',$Wec))||(preg_match('/Mac.OS/i',$Wec))&&(preg_match('/Silk/i',$Wec))){$Wed="tablet";}elseif((preg_match('/GT-P10|SC-01C|SHW-M180S|SGH-T849|SCH-I800|SHW-M180L|SPH-P100|SGH-I987|zt180|HTC(.Flyer|\_Flyer)|Sprint.ATP51|ViewPad7|pandigital(sprnova|nova)|Ideos.S7|Dell.Streak.7|Advent.Vega|A101IT|A70BHT|MID7015|Next2|nook/i',$Wec))||(preg_match('/MB511/i',$Wec))&&(preg_match('/RUTEM/i',$Wec))){$Wed="tablet";}elseif((preg_match('/BOLT|Fennec|Iris|Maemo|Minimo|Mobi|mowser|NetFront|Novarra|Prism|RX-34|Skyfire|Tear|XV6875|XV6975|Google.Wireless.Transcoder/i',$Wec))){$Wed="mobile";}elseif((preg_match('/Opera/i',$Wec))&&(preg_match('/Windows.NT.5/i',$Wec))&&(preg_match('/HTC|Xda|Mini|Vario|SAMSUNG\-GT\-i8000|SAMSUNG\-SGH\-i9/i',$Wec))){$Wed="mobile";}elseif((preg_match('/Windows.(NT|XP|ME|9)/',$Wec))&&(!preg_match('/Phone/i',$Wec))||(preg_match('/Win(9|.9|NT)/i',$Wec))){$Wed="desktop";}elseif((preg_match('/Macintosh|PowerPC/i',$Wec))&&(!preg_match('/Silk/i',$Wec))){$Wed="desktop";}elseif((preg_match('/Linux/i',$Wec))&&(preg_match('/X11/i',$Wec))){$Wed="desktop";}elseif((preg_match('/Solaris|SunOS|BSD/i',$Wec))){$Wed="desktop";}elseif((preg_match('/Bot|Crawler|Spider|Yahoo|ia_archiver|Covario-IDS|findlinks|DataparkSearch|larbin|Mediapartners-Google|NG-Search|Snappy|Teoma|Jeeves|TinEye/i',$Wec))&&(!preg_match('/Mobile/i',$Wec))){$Wed="desktop";}else{$Wed="mobile";}if($Wed=="tv")$Wed="tablet";if($Wed=="desktop")$Wed=false;return$Wed;}final class light_Device{public$Wee;public function __construct(){$this->mobile_agents=array('iPod','iPhone','webOS','BlackBerry','windows phone','symbian','vodafone','opera mini','windows ce','smartphone','palm','midp');$this->exclude_mobile_agents=array();$this->tablet_agents=array('iPad','RIM Tablet','hp-tablet','Kindle Fire','Android');$this->exclude_tablet_agents=array();if(isset($_GET['change_device'])){$Wef=$_GET['device_name'];$_SESSION['set_device']=$Wef;}if(!isset($_SESSION['set_device'])){if((!isset($_SESSION['device']))||(!isset($_COOKIE['device']))){if($this->isTablet()){$this->set("tablet");}elseif($this->isMobile()){$this->set("mobile");}else{$this->set("desktop");}}}elseif(isset($_GET['change_device'])){if($Wef=='mobile_desktop'||$Wef=='tablet_desktop'){$_SESSION['device']='desktop';}elseif($Wef=='mobile'){$_SESSION['device']='mobile';}elseif($Wef=='tablet'){$_SESSION['device']='tablet';}}}public function set($Wee){$_SESSION['device']=$Wee;}public function isMobile(){$Weg=false;if(isset($_SERVER['HTTP_USER_AGENT'])){foreach($this->mobile_agents as$Weh){if(stripos($_SERVER['HTTP_USER_AGENT'],$Weh)){$Weg=true;}}if(stripos($_SERVER['HTTP_USER_AGENT'],"Android")&&stripos($_SERVER['HTTP_USER_AGENT'],"mobile")){$Weg=true;}foreach($this->exclude_mobile_agents as$Wei){if(stripos($_SERVER['HTTP_USER_AGENT'],$Wei)){echo'exclude';$Weg=false;}}}return$Weg;}public function isTablet(){$Wej=false;if(isset($_SERVER['HTTP_USER_AGENT'])){foreach($this->tablet_agents as$Wek){if(stripos($_SERVER['HTTP_USER_AGENT'],$Wek)){$Wej=true;}}if(stripos($_SERVER['HTTP_USER_AGENT'],"Android")&&stripos($_SERVER['HTTP_USER_AGENT'],"mobile")){$Wej=false;}foreach($this->exclude_tablet_agents as$Wel){if(stripos($_SERVER['HTTP_USER_AGENT'],$Wel)){$Wej=false;}}}return$Wej;}}function Wam($Wdk){global$light_distinct_gadgets,$light_treat_tablets_as;$Wed='';if(file_exists(DIR_SYSTEM."library/categorizr.php")){require_once(DIR_SYSTEM."library/categorizr.php");if(isMobile())$Wed="mobile";elseif(isTablet())$Wed="tablet";}elseif(file_exists(DIR_SYSTEM."library/device.php")){$Wee=new Wdi();$Wed=$_SESSION['ca'];}elseif($light_distinct_gadgets)$Wed=Wan();if($Wed=="tablet")$Wed=$light_treat_tablets_as;if($Wed=="desktop"||$Wed=="pc")$Wed='';if($Wed)$Wdk.="_".$Wed;return$Wdk;}function Wc(){global$Wp,$Wh;$Wem=$Wp['an'];if(isset($_GET["currency"])&&(array_key_exists($_GET["currency"],$Wem))){$Wdb=$_GET["currency"];}elseif($Wh&&(isset($_SESSION["currency"]))&&(array_key_exists($_SESSION["currency"],$Wem))){$Wdb=$_SESSION["currency"];}elseif((isset($_COOKIE["currency"]))&&(array_key_exists($_COOKIE["currency"],$Wem))){$Wdb=$_COOKIE["currency"];if(!empty($_SESSION["currency"]))$_SESSION["currency"]=$Wdb;}else{$Wdb=$Wp['f'];if(!empty($_SESSION["currency"]))$_SESSION["currency"]=$Wdb;}return$Wdb;}function Wab(&$Wf,$Wen=2){if(headers_sent()){Wk($Wf);return;}if(!empty($_SERVER["HTTP_ACCEPT"])){if(substr($_SERVER["HTTP_ACCEPT"],0,5)=="image"&&!strpos($_SERVER["HTTP_ACCEPT"],"xml")){Wk($Wf);return;}}if(isset($_SERVER["HTTP_ACCEPT_ENCODING"])&&(strpos($_SERVER["HTTP_ACCEPT_ENCODING"],"gzip")!==false)){$Weo="gzip";}if(isset($_SERVER["HTTP_ACCEPT_ENCODING"])&&(strpos($_SERVER["HTTP_ACCEPT_ENCODING"],"x-gzip")!==false)){$Weo="x-gzip";}if(!empty($_SERVER["HTTP_USER_AGENT"]))if(strpos($_SERVER["HTTP_USER_AGENT"],"MSIE 7")||strpos($_SERVER["HTTP_USER_AGENT"],"MSIE 8"))$Weo=false;if(empty($Weo)){Wk($Wf);return;}if(!extension_loaded("zlib")||ini_get("zlib.output_compression")){Wk($Wf);return;}if(headers_sent()){Wk($Wf);return;}if(connection_status()){Wk($Wf);return;}header("Content-Encoding: ".$Weo);if(ord($Wf[0])!=31)$Wf=gzencode($Wf,$Wen);return true;}function Wao(){global$Wep,$Wad,$Weq,$Wer;$Wes=0;if($Wad){$Wet="Served in ".Waq(microtime(true)-$Wep)." sec from page cache written ".War(microtime(true)-$Wad)." ago. ";}else{$Wes=microtime(true)-$Wep;$Wet="Generated in ".Waq($Wes)." sec. ";}$Weu=false;if($Wer){$Wet.=$Wer." cached queries, ";$Weu="real ";}if($Weq==1)$Wet.="1 ".$Weu."DB query used.";elseif($Weq)$Wet.=$Weq." ".$Weu."DB queries used.";else{if($Weu)$Wet.="no ";else$Wet.="No ";$Wet.=$Weu."DB connection used.";}global$Wev,$Wew;if($Wes){$Wex=$Wes-$Wev;$Wey=$Wev-$Wew;$Wez=round($Wex/$Wes*100);$We_=round($Wey/$Wes*100);$Wfa=round($Wew/$Wes*100);$Waz=array();if($Wez)$Waz[]=$Wez."% PHP";if($We_)$Waz[]=$We_."% Beta";if($Wfa)$Waz[]=$Wfa."% SQL";$Wet.=" [".implode(", ",$Waz)."]";}if(!headers_sent())header("X-OpenCart-Lightning: ".$Wet);}function Wo($Wf,$Wfb=false){if($Wf){Wab($Wf);}Wao();if(!headers_sent()){header("Content-Length: ".strlen($Wf));if($Wfb)header("Connection: Close");}echo$Wf;if($Wfb){if(@ob_get_level())@ob_flush();@flush();if(function_exists("fastcgi_finish_request"))@fastcgi_finish_request();}Wap();}function Waq($Wfc){if($Wfc<1)$Wfc=round($Wfc,3);elseif($Wfc<2)$Wfc=round($Wfc,2);elseif($Wfc<6)$Wfc=round($Wfc,1);else$Wfc=round($Wfc);return($Wfc);}function War($Wbc){if($Wbc<60)return Waq($Wbc)." sec";$Wbc=round($Wbc/60);if($Wbc<60)return$Wbc." min";$Wbc=round($Wbc/60);if($Wbc==1)return"1 hour";if($Wbc<60)return$Wbc." hours";$Wbc=round($Wbc/24);if($Wbc==1)return"1 day";return$Wbc." days";}function Wj($Wdz){global$light_pagetime;$Wfd=crc32($Wdz)%($light_pagetime*20);return$Wfd;}function Wal($War,$Wfe){$Wff=curl_init($War);curl_setopt($Wff,CURLOPT_URL,$War);curl_setopt($Wff,CURLOPT_RETURNTRANSFER,1);curl_setopt($Wff,CURLOPT_ENCODING,"");curl_setopt($Wff,CURLOPT_TIMEOUT,200);curl_setopt($Wff,CURLOPT_CONNECTTIMEOUT,200);if($Wfe){curl_setopt($Wff,CURLOPT_POST,1);curl_setopt($Wff,CURLOPT_POSTFIELDS,$Wfe);}$Wfg=curl_exec($Wff);global$Wfh;$Wfh=curl_getinfo($Wff,CURLINFO_HTTP_CODE);return$Wfg;}function Was(){if(empty($_COOKIE['a']))return false;global$session;if(session_id())session_write_close();$Wfi=array_fill(0,1012,0);$session->data["wishlist"]=$Wfi;$Wfi[]=0;$session->data["compare"]=$Wfi;if($_COOKIE['a']!=2)return false;$Wfj["customer_id"]=4567;$Wfj["firstname"]="Mirabelya";$Wfj["lastname"]="Lightmeni";$Wfj["email"]="mirabelya@lightmen.com";return$Wfj;}function Wat($Wfk,&$Wcd){$Wbp=Wy("template/",".tpl",$Wfk);$Wbp=str_replace("_mobile","",$Wbp);$Wbp=str_replace("_tablet","",$Wbp);global$Wq,$Ws;if(!($Wq=="gens"and$Ws)&&Wae("ajax_update",$Wbp)&&!Ww()){global$Wcf;$Wcf[]=$Wbp;$Wcd="<div id='".str_replace("/","_",$Wbp)."'></div>";return false;}if(empty($_COOKIE['a']))return false;if($Wbp=="common/cart"||$Wbp=="module/cart"){$Wcd='<Wao>'.$Wcd.'<Wap>';if($_COOKIE['a']==1){$Wfl[]=Wz("language")->get("decimal_point");$Wfl[]=Wz("language")->get("thousand_point");$Wcd.='<Was>'.base64_encode(serialize($Wfl)).'<Wat>';}}elseif($Wbp=="module/currency"||$Wbp=="common/currency"){if($_COOKIE['a']==1){$Wcd='<Waq>'.$Wcd.'<War>';$Wfl[]=Wz("language")->get("decimal_point");$Wfl[]=Wz("language")->get("thousand_point");$Wcd.='<Was>'.base64_encode(serialize($Wfl)).'<Wat>';return false;}static$Wem,$Wfm,$Wfn;if($Wfn)return false;global$db;if(!$Wfm)$Wfm=Wz("currency")->getCode();$Wcd=$Wcd.'<Wau'.Wz("currency")->getCode().'>';if(!strpos($Wcd,'<War>')){$Wcd='<Waq>'.$Wcd.'<War>';$Wdq=$db->query("SELECT * FROM ".DB_PREFIX."currency WHERE status=1");foreach($Wdq->rows as$Wfg)$Wem[]=$Wfg["code"];}if($Wem){if(VERSION>="2.0"){foreach($Wem as$Wfo){$Wfn=true;Wz("currency")->set($Wfo);$Wcd.=Wz("load")->controller("common/currency").'<Wau'.Wz("currency")->getCode().'>';$Wfn=false;}}else{$Wdz=array_keys($Wem);$Wdz=reset($Wdz);Wz("currency")->set($Wem[$Wdz]);unset($Wem[$Wdz]);return$Wbp;}}if($Wfm)Wz("currency")->set($Wfm);}return false;}function Wak($Wet){global$Wdv,$Wm,$Wp;file_put_contents($Wdv,$Wet);if(file_exists(Wb))unlink(Wb);if(file_exists(Wb.$Wm))unlink(Wb.$Wm);$Wp=false;}function Wau($Wfp){global$Wfq,$Wfr;static$Wfs,$Wft,$Wfu,$Wfv,$Wfw,$Wfx;if($Wfs!=$Wfr){global$Wp,$Wg;$Wfs=$Wfr;$Wft=(int)$Wp['an'][$Wfr]['av'];if(!$Wft&&$Wft!=="0")$Wft=2;$Wfu=$Wp['an'][$Wfr]['aw'];$Wfv=$Wp['an'][$Wfr]['ax'];$Wfw=$Wg['ay'];$Wfx=$Wg['az'];}$Wd_=Wav($Wfp[1])*$Wfq;$Wfy=$Wfu.number_format(round($Wd_,$Wft),$Wft,$Wfw,$Wfx).$Wfv;return$Wfy;}function Wn($Wfz,$Wfs,&$Wf){global$Wp,$Wg,$Wfq,$Wfr;if(isset($Wp['an'][$Wfz])){$Wf_=$Wp['an'][$Wfz]['a_'];}else{return;}if(isset($Wp['an'][$Wfs])){$Wga=$Wp['an'][$Wfs]['a_'];}else{return;}$Wfq=$Wga/$Wf_;$Wfr=$Wfs;$Wf=preg_replace_callback("/".preg_quote($Wp['an'][$Wfz]['aw'])."([0-9][0-9".preg_quote($Wg['az']).preg_quote($Wg['ay'])."]*)".preg_quote($Wp['an'][$Wfz]['ax'])."/u",'Wau',$Wf);}function Waw($Wgb=false,$Wcd=false){if(!$Wgb)unset($_SESSION['i']);else$_SESSION['i']=$Wcd;}function Wax($Wgc){$_SESSION['m']=$Wgc["firstname"];}function Wav($Wgd){$Wfc=preg_replace("/[^0-9.,]/i",'',$Wgd);if(substr($Wfc,-3,1)==","){$Wfc=substr($Wfc,0,-3).".".substr($Wfc,-2);$Wfc=str_replace(",","",$Wfc);}$Wfc=str_replace(",","",$Wfc);$Wge=round(abs($Wfc),2);return$Wge;}function Wag($Wcw,$Wgf,$Wcp){preg_match_all("/$Wcw([^$Wgf]*)/i",$Wcp,$Wfp);return($Wfp[1]);}function Way(){global$Wq;if($Wq)return true;else return false;}function Wz($Wgg){global$registry;return$registry->get($Wgg);}