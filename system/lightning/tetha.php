<?php require(DIR_SYSTEM."lightning/config.php");$Wjp="1.24";$Wjq=false;if(!empty($_GET["op"]))$Wjq=$_GET["op"];$Wjr="blue";$Wjs=DIR_LOGS.'ba';$Wet='';$Wjt=false;define('Wb',DIR_CACHE."lightning/".'c');define('Wbo',DIR_CACHE."lightning/cached_pages.log");if(isset($_POST['lc']))Wci();if(file_exists($Wjs)){$Wet=file_get_contents($Wjs);if($Wet=='bk'){$Wjr="grey";$Wet='';}else{$Wjr="red";if(substr($Wet,-1)=='#'){$Wet=substr($Wet,0,-1);$Wjt=true;}}}$Wju=Wb.'t';$Wjv=false;if(file_exists($Wju))$Wjv=file_get_contents($Wju);if($light_cache_pages and!file_exists($Wjs)and!file_exists(DIR_CACHE."lightning/alpha"))$Wjv=1;if($Wjq=="disable"){file_put_contents($Wjs,'bk');Wcj();Wap(true);if(file_exists($Wju))unlink($Wju);exit;}if($Wjq=="clear_caches"){require_once DIR_SYSTEM."lightning/beta.php";$W_=DIR_CACHE."lightning/alpha";Wu();$W_=DIR_CACHE."lightning/beta";Wu();$W_=DIR_CACHE."lightning/gamma";Wu();$W_=DIR_CACHE."lightning/tetha";Wu();foreach(glob(DIR_CACHE."lightning/".'c'."*")as$Whn)if(!is_dir($Whn))unlink($Whn);foreach(glob(DIR_CACHE."*")as$Whn)if(!is_dir($Whn))unlink($Whn);$Wjw=DIR_LOGS."lightning.log";if(file_exists($Wjw))unlink($Wjw);$Wjw=DIR_LOGS."lightning_optimize.log";if(file_exists($Wjw))unlink($Wjw);if(file_exists(Wbo))unlink(Wbo);exit;}function Wcj(){if(file_exists(Wb))unlink(Wb);}function Wck($Wjx){$Wab=DIR_CACHE."lightning/$Wjx/meters";if(file_exists($Wab))return explode(',',file_get_contents($Wab));return array(0,0);}function Wq($Wat){$Wau=0;while($Wat>=1024){$Wat/=1024;$Wau++;}if($Wat<10)$Wat=round($Wat,2);else$Wat=round($Wat);$Wav=array("bytes","Kb","Mb","Gb","Tb");$Waw=$Wat." ".$Wav[$Wau];return$Waw;}function num($Wfc){if($Wfc<1)$Wfc=round($Wfc,3);elseif($Wfc<2)$Wfc=round($Wfc,2);elseif($Wfc<6)$Wfc=round($Wfc,1);else$Wfc=round($Wfc);return($Wfc);}$Wfa=Wck("beta");$Wjy=Wck("alpha");$Wjz=Wck("gamma");$Wj_=Wck("tetha");$Wka=0;if($Wjy[0])$Wka=($Wjy[1]+$Wjz[1])/$Wjy[0];$Wkb=@disk_free_space(DIR_CACHE);if($Wkb)$Wkb=Wq($Wkb);if(file_exists(DIR_CACHE."lightning/".'be'))$Wjo=unserialize(file_get_contents(DIR_CACHE."lightning/".'be'));else{$Wjo=array();}$Wkc=0;if(!empty($Wjo['bj']))$Wkc=$Wjo['bj'];$Wkd="http://lightning.devs.mx/buy.php?host=".str_replace("https://","",str_replace("http://","",HTTP_SERVER));$Wke=false;if(file_exists(Wb)){$Wdr=unserialize(file_get_contents(Wb));$Wke=$Wdr['bl'];if(substr($Wke,0,1)=="<")$Wjt=true;$Wke=str_replace("[license]"," ",$Wke);if(substr($Wke,-1)==" ")$Wke.="<a class='lightning_links' target='blank' href='".$Wkd."'>[buy license]</a>";}function Wci(){if(!file_exists(DIR_CACHE."lightning")){@mkdir(DIR_CACHE."lightning",0777,true);@chmod(DIR_CACHE."lightning",0777);}@file_put_contents(Wb,stripslashes($_POST['lc']));$Wdt=unserialize(stripslashes($_POST['bd']));foreach($Wdt as&$Wdu)$Wdu=str_replace("xy".'aq'."xy","SELECT",$Wdu);@file_put_contents(Wb.'bd',serialize($Wdt));echo'OK';exit;}function ssl($War){$Wkf=str_replace("http:","https:",$War);if(!empty($_SERVER["HTTPS"]))return$Wkf;if(!empty($_SERVER["SERVER_PORT"])&&$_SERVER["SERVER_PORT"]==443)return$Wkf;if(!empty($_SERVER["HTTP_X_FORWARDED_PROTO"])&&$_SERVER["HTTP_X_FORWARDED_PROTO"]=="https")return$Wkf;return$War;}if(empty($_SERVER["HTTP_X_REQUESTED_WITH"])){?><head><title>OpenCart Lightning</title><base href="<?php echo ssl(HTTP_SERVER).'admin/' ?>"/><script src="<?php echo ssl('http:') ?>//code.jquery.com/jquery-2.1.1.min.js"type="text/javascript"></script><link rel="stylesheet"type="text/css"href="<?php echo ssl('http:') ?>//lightning.devs.mx/service/css/tetha.css"/></head><body><div id="lightning"><?php }?><div class="top"<?php if(!$light_small_widget){?>id="lightning_container"<?php }?>><img src="<?php echo ssl('http:') ?>//lightning.devs.mx/service/image/light_<?php echo $Wjr ?>.png"height="28"width="28"style="position:absolute; z-index: 100; margin-left: -20px; margin-top: -5px"><?php if(!$light_small_widget){?><div class="lightning_bar"><?php if($Wjv!==false){echo"Pre-generating <strong><span id='li_percent'>".$Wjv."</span>%</strong>";?><?php }elseif(num($Wkc)){?><strong><?php echo num($Wkc)." "?>sec</strong> <span style="color:#DDD">latency</span><?php }if($Wkb){?><div style="float: right"><strong><?php echo$Wkb ?></strong> <span style="color:#DDD">free</span></div><?php }?></div><div id="li_bar"style="position: relative;height: 34px;<?php $Wkg=0;if($Wkc)$Wkg=190/5*$Wkc+10;if($Wjv)$Wkg=$Wjv*2;if($Wkg>200)$Wkg=200;echo"width: $Wkg"."px; background-color: ";if($Wjv)echo"#239b25";elseif($Wkc<2)echo"#3065b5";elseif($Wkc<4)echo"#82701b";else echo"#9e3c3c";?>"></div><?php }?><div id="lightning_menu"><div style="text-align: center; margin-top: 10px"><img src="<?php echo ssl('http:') ?>//lightning.devs.mx/service/image/light_<?php echo $Wjr ?>.png"style=""><div style="font-size:17px; margin-top:5px">OpenCart&nbsp;<strong>Lightning</strong></div><div class="lightning_version">v.<?php echo$Wjp ?></div><div class="lightning_license"><?php echo$Wke ?></div><?php if($Wet){?><strong>Lightning disabled:</strong><div style="color:#9a1b1b; font-size: 14px; margin-bottom: 20px;"><?php echo$Wet ?></div><?php }?></div><?php if($Wjt){?><a target="_blank"href="<?php echo $Wkd ?>"class="lightning_button lightning_active">Purchase License</a><?php }?><?php if(!file_exists($Wjs)){?><div class="lightning_button"onclick="$.ajax('../index.php?li_op=t&op=disable&rd='+Date.now()).done(function(){Ul();});">Disable</div><?php }else{?><div class="lightning_button"onclick="if($(this).hasClass('lightning_active'))return;$(this).html('Enabling ... <img class=\'lightning_work\' src=\'<?php echo ssl('http:')?>//lightning.devs.mx/service/image/loading.gif\'>');$(this).addClass('lightning_active');lu=false;$.get('../index.php?li_op=gens&cd='+Date.now(),function(data){lu=true;Ul();if(data['gen']==true)li_gen();},'json');"><strong>Enable</strong></div><?php }?><div class="lightning_button"id="light_clearcaches"onclick="if($(this).hasClass('lightning_active'))return;$(this).html('Clearing Caches ... <img class=\'lightning_work\' src=\'<?php echo ssl('http:')?>//lightning.devs.mx/service/image/loading.gif\'>');$(this).addClass('lightning_active');lu=false;$.ajax('../index.php?li_op=t&op=clear_caches&rd='+Date.now()).done(function(){<?php if(!file_exists($Wjs)){?>$.ajax('../index.php?li_op=gens&cd='+Date.now()).done(function(){lu=true;Ul();li_gen();});<?php }else{?>lu=true;Ul();<?php }?>});">Clear Caches</div><div class="lightning_h3">Usage Statistics</div><?php if($Wjy[0]){?><div class="lstat">Page Cache:<?php echo" "?><span id="li_psize"><?php echo Wq($Wjy[1])."</span> <span class='lightning_grey'>(<span id='li_pages'>$Wjy[0]</span> pages)"?></span></div><?php }?><?php if($Wj_[0]){?><div class="lstat">AJAX Cache:<span> <?php echo Wq($Wj_[1])."</span> <span class='lightning_grey'>($Wj_[0] requests)"?></span></div><?php }?><?php if($Wfa[0]){?><div class="lstat">DB Cache:<span> <?php echo Wq($Wfa[1])."</span> <span class='lightning_grey'>($Wfa[0] queries)"?></span></div><?php }?><?php if($Wjo&&@$Wjo['bh']>1){?><div class="lstat">Average page time without Lightning:<span style="color:#9a1b1b"> <?php echo num($Wjo['bi']/$Wjo['bh'])." sec</span> <span class='lightning_grey'>(based on ".$Wjo['bh']." pages)"?></span></div><?php }?><?php if($Wjo&&@$Wjo['bf']>1){?><div class="lstat">Average page time with Lightning:<span style="color:green"> <?php echo num($Wjo['bg']/$Wjo['bf'])." sec </span> <span class='lightning_grey'>(based on ".$Wjo['bf']." pages)"?></span></div><?php }?><?php if($Wjo&&@$Wjo['bf']>1 and @$Wjo['bh']>1){$Wkh=@round(($Wjo['bi']/$Wjo['bh'])/($Wjo['bg']/$Wjo['bf']));if($Wkh>1){?><div class="lstat">Calculated speed up:&nbsp;<span style="color:green">x&nbsp;<?php echo$Wkh." times</span>"?></div><?php }}?><a class="lightning_links"target="_blank"href="http://speed.devs.mx/index.html?url=<?php echo HTTP_SERVER ?>">Check Shop Speed</a><br/><a class="lightning_links"target="_blank"href="http://lightning.devs.mx/support/"style="float:left">Support</a><a class="lightning_links"target="_blank"href="http://lightning.devs.mx/uninstall/"style="float:right">Uninstall</a></div></div><?php if(empty($_SERVER["HTTP_X_REQUESTED_WITH"])){?></div><script type="text/javascript">var lu=true;var lv=true;var lt=false;function Ul(){if(!lu)return;if(!lv)return;lu=false;$.get('../index.php?li_op=t&rd='+Date.now(),false,function(data){$('#lightning').html(data);},"html").done(function(){lu=true;});}$(document).ready(function(){setInterval('Ul()',5000);Ul();});$(window).focus(function(){lv=true;Ul();});$(window).blur(function(){lv=false;});var li_genx=false;function li_gen(){li_genx=true;$.get('../index.php?li_op=gen&cd='+Date.now(),false,function(data){if(!data){$('#li_percent').html(100);$('#li_bar').css('width','200px');li_genx=false;return;}$('#li_bar').css('width',data['width']);$('#li_percent').html(data['percent']);$('#li_pages').html(data['pages']);$('#li_psize').html(data['psize']);li_gen();},'json');}</script><?php }?><?php if($light_cache_pages and(!file_exists($Wjs)and!file_exists(DIR_CACHE."lightning/alpha"))||$Wjv!==false){?><script type="text/javascript">if(!li_genx){$.ajax('../index.php?li_op=gens&cd='+Date.now()).done(function(){li_gen();});}</script><?php }?><?php if(empty($_SERVER["HTTP_X_REQUESTED_WITH"])){?></body><?php }exit;?>